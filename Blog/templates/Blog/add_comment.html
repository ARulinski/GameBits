{% load static %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<style>
    /* Add your existing CSS styles here */
</style>

<div class="comment-section">
    {% if not comments %}
        <h3 class="nocomment">No comments yet..</h3>
    {% else %}
        {% for comment in comments %}
            <div class="comment">
                <div class="comment-content">
                    <img src="{{ comment.name.avatar.url }}" alt="{{ comment.name.username }}" class="avatar1">
                    <div class="comment-details">
                        <strong class="username">{{ comment.name.username }}</strong>
                        <span class="comment-date">{{ comment.date_added }}</span>
                        <p class="body">{{ comment.comment_body }}</p>
                    </div>
                </div>
                <div class="comment-actions">
                    <div class="action-item reply-btn" data-comment-id="{{ comment.id }}">
                        <i class="fas fa-reply"></i><span>Reply</span>
                    </div>
                    <br/>
                    <br/>
                    {% if request.user.is_authenticated and comment.name == request.user %}
                        <div class="action-item">
                            <i class="fas fa-trash"></i><span>Delete</span>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Nested Replies Container -->
            <div class="nested-replies-container">
                {% if comment.replies.all %}
                    {% for reply in comment.replies.all %}
                        <div class="comment">
                            <div class="comment-content">
                                <img src="{{ reply.name.avatar.url }}" alt="{{ reply.name.username }}" class="avatar1">
                                <div class="comment-details">
                                    <strong class="username">{{ reply.name.username }}</strong>
                                    <span class="comment-date">{{ reply.date_added }}</span>
                                    <p class="body">{{ reply.reply_body }}</p>
                                </div>
                            </div>
                            <div class="comment-actions">
                                <br/>
                                <br/>
                                {% if request.user.is_authenticated and reply.name == request.user %}
                                    <div class="action-item">
                                        <i class="fas fa-trash"></i><span>Delete</span>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                {% endif %}
            </div>
        {% endfor %}
    {% endif %}
</div>

<!-- Comment Form -->
<div class="form-container comment-form">
    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit" name="comment_form" class="submit-btn">Post Comment</button>
    </form>
</div>

<!-- Reply Form -->
<div class="form-container reply-form" style="display: none;">
    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        <input type="hidden" name="comment_id" value="" id="comment_id">
        {{ form2.as_p }}
        <button type="submit" name="reply_form" class="submit-btn">Post Reply</button>
    </form>
</div>

<script>
    // Add JavaScript to handle showing the reply form when the reply button is clicked
    document.addEventListener('DOMContentLoaded', function () {
        document.querySelectorAll('.reply-btn').forEach(function (button) {
            button.addEventListener('click', function () {
                const commentId = this.getAttribute('data-comment-id');
                document.getElementById('comment_id').value = commentId;
                document.querySelector('.reply-form').style.display = 'block';
                document.querySelector('.reply-form').scrollIntoView({ behavior: 'smooth' });
            });
        });
    });
</script>
